-- ============================================
-- å¿«é€Ÿå¹³æ»‘ä¼ é€è„šæœ¬ v2.1 (æ–°å¢æœ€å°åŒ–+ä¼˜åŒ–ç§»åŠ¨)
-- å¸¦ç©å®¶ä¸‹æ‹‰é€‰æ‹©èœå• + çª—å£æœ€å°åŒ–/æ‹–åŠ¨åŠŸèƒ½
-- æ³¨å…¥æ‰§è¡Œç‰ˆ
-- ============================================
-- æœåŠ¡
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")
-- æœ¬åœ°ç©å®¶
local LocalPlayer = Players.LocalPlayer
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local HumanoidRootPart = Character:WaitForChild("HumanoidRootPart")
-- é…ç½® (å¯è‡ªå®šä¹‰)
local Config = {
    TeleportSpeed = 200,         -- ä¼ é€é€Ÿåº¦ (è¶Šå¤§è¶Šå¿«)
    TeleportHeight = 3,          -- é«˜åº¦åç§»
    Smoothness = 0.15,           -- å¹³æ»‘åº¦ (0-1, è¶Šå°è¶Šå¹³æ»‘)
    UpdateRate = 0.016,          -- æ›´æ–°é¢‘ç‡ (ç§’)
    ShowDistance = true,         -- æ˜¾ç¤ºè·ç¦»
    AutoRespawn = true,          -- è‡ªåŠ¨é‡ç”Ÿåé‡æ–°å¼€å§‹
    UseCFrameMethod = true,      -- ä½¿ç”¨CFrameæ–¹æ³• (æ›´ç¨³å®š)
    DebugMode = false           -- è°ƒè¯•æ¨¡å¼
}
-- çŠ¶æ€å˜é‡
local Teleporting = false
local TargetPlayer = nil
local PlayersList = {}
local CurrentIndex = 1
local UI = nil
local MainLoop = nil
local IsMinimized = false  -- æ–°å¢ï¼šæœ€å°åŒ–çŠ¶æ€æ ‡è®°
-- å·¥å…·å‡½æ•°
local function PrintDebug(msg)
    if Config.DebugMode then
        print("[ä¼ é€è°ƒè¯•]: " .. msg)
    end
end
local function ShowNotification(title, text, duration)
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = title,
        Text = text,
        Duration = duration or 3,
        Icon = "rbxassetid://4483345998"
    })
end
-- è®¡ç®—ç©å®¶é—´çš„è·ç¦»
local function GetDistance(player1, player2)
    if not player1.Character or not player2.Character then
        return math.huge
    end
    local hrp1 = player1.Character:FindFirstChild("HumanoidRootPart")
    local hrp2 = player2.Character:FindFirstChild("HumanoidRootPart")
    if not hrp1 or not hrp2 then
        return math.huge
    end
    return (hrp1.Position - hrp2.Position).Magnitude
end
-- è·å–æ‰€æœ‰åœ¨çº¿ç©å®¶ï¼ˆæ’é™¤è‡ªå·±ï¼‰
local function GetOnlinePlayers()
    local players = {}
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character then
            table.insert(players, player)
        end
    end
    return players
end
-- å¿«é€Ÿå¹³æ»‘ä¼ é€å‡½æ•° (æ”¹è¿›ç‰ˆ)
local function FastSmoothTeleport(targetCFrame)
    if not HumanoidRootPart then return end
    local startCFrame = HumanoidRootPart.CFrame
    local startTime = tick()
    local duration = (targetCFrame.Position - startCFrame.Position).Magnitude / Config.TeleportSpeed
    duration = math.max(duration, 0.1)  -- ç¡®ä¿æœ€å°æŒç»­æ—¶é—´
    local t = 0
    while t < 1 and Teleporting do
        t = (tick() - startTime) / duration
        local easeT = t * t * (3 - 2 * t)  -- ç«‹æ–¹ç¼“åŠ¨
        local newPosition = startCFrame.Position:Lerp(targetCFrame.Position, easeT)
        local newLookVector = startCFrame.LookVector:Lerp(targetCFrame.LookVector, easeT)
        HumanoidRootPart.CFrame = CFrame.new(newPosition, newPosition + newLookVector)
        RunService.RenderStepped:Wait()
    end
    if Teleporting then
        HumanoidRootPart.CFrame = targetCFrame
    end
end
-- æ›´å¿«çš„ç›´çº¿ä¼ é€ (æ— å¹³æ»‘æ•ˆæœ)
local function DirectTeleport(targetCFrame)
    if not HumanoidRootPart then return end
    HumanoidRootPart.CFrame = targetCFrame
end
-- å¸¦é¢„æµ‹çš„å¿«é€Ÿä¼ é€ (æœ€å¿«)
local function PredictiveTeleport(targetPlayer)
    if not HumanoidRootPart or not targetPlayer.Character then return end
    local targetHRP = targetPlayer.Character:FindFirstChild("HumanoidRootPart")
    if not targetHRP then return end
    local targetVelocity = Vector3.new(0, 0, 0)
    if targetHRP:FindFirstChild("Velocity") then
        targetVelocity = targetHRP.Velocity
    end
    local predictionTime = Config.UpdateRate * 2
    local predictedPosition = targetHRP.Position + (targetVelocity * predictionTime)
    predictedPosition = predictedPosition + Vector3.new(0, Config.TeleportHeight, 0)
    HumanoidRootPart.CFrame = CFrame.new(predictedPosition, predictedPosition + Vector3.new(0, 0, 1))
end
-- ä¼ é€å¾ªç¯ä¸»å‡½æ•°
local function TeleportLoop()
    while Teleporting and RunService.Heartbeat:Wait() do
        if not TargetPlayer or not TargetPlayer.Character then
            PrintDebug("ç›®æ ‡ä¸¢å¤±")
            break
        end
        local targetChar = TargetPlayer.Character
        local targetHRP = targetChar:FindFirstChild("HumanoidRootPart")
        if not targetHRP then
            task.wait(0.1)
            continue
        end
        local targetPosition = targetHRP.Position + Vector3.new(0, Config.TeleportHeight, 0)
        local lookVector = (targetPosition - HumanoidRootPart.Position).Unit
        local targetCFrame = CFrame.new(targetPosition, targetPosition + lookVector)
        if Config.UseCFrameMethod then
            DirectTeleport(targetCFrame)
        else
            FastSmoothTeleport(targetCFrame)
        end
        task.wait(Config.UpdateRate)
    end
end
-- åˆ›å»ºä¸‹æ‹‰èœå•UI (æ–°å¢æœ€å°åŒ–+ä¼˜åŒ–ç§»åŠ¨)
local function CreateDropdownUI()
    -- é”€æ¯ç°æœ‰UI
    if UI then
        UI:Destroy()
        UI = nil
    end
    -- åˆ›å»ºä¸»GUI
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "FastTeleportUI_" .. HttpService:GenerateGUID(false)
    ScreenGui.Parent = game:GetService("CoreGui")
    -- ä¸»å®¹å™¨
    local MainFrame = Instance.new("Frame")
    MainFrame.Size = UDim2.new(0, 350, 0, 400)
    MainFrame.Position = UDim2.new(0.5, -175, 0.5, -200)
    MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
    MainFrame.BorderSizePixel = 0
    MainFrame.ClipsDescendants = true
    MainFrame.Parent = ScreenGui
    -- åœ†è§’
    local UICorner = Instance.new("UICorner")
    UICorner.CornerRadius = UDim.new(0, 8)
    UICorner.Parent = MainFrame
    -- æ ‡é¢˜æ  (æ–°å¢æœ€å°åŒ–æŒ‰é’®ä½ç½®)
    local TitleBar = Instance.new("Frame")
    TitleBar.Size = UDim2.new(1, 0, 0, 40)
    TitleBar.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
    TitleBar.BorderSizePixel = 0
    TitleBar.Parent = MainFrame
    local TitleCorner = Instance.new("UICorner")
    TitleCorner.CornerRadius = UDim.new(0, 8)
    TitleCorner.Parent = TitleBar
    -- æ ‡é¢˜æ–‡æœ¬
    local Title = Instance.new("TextLabel")
    Title.Size = UDim2.new(1, -100, 1, 0)  -- é¢„ç•™æœ€å°åŒ–/å…³é—­æŒ‰é’®ç©ºé—´
    Title.Position = UDim2.new(0, 15, 0, 0)
    Title.BackgroundTransparency = 1
    Title.Text = "ğŸš€ å¿«é€Ÿä¼ é€å™¨"
    Title.TextColor3 = Color3.fromRGB(255, 255, 255)
    Title.Font = Enum.Font.GothamBold
    Title.TextSize = 18
    Title.TextXAlignment = Enum.TextXAlignment.Left
    Title.Parent = TitleBar
    -- æ–°å¢ï¼šæœ€å°åŒ–æŒ‰é’®
    local MinimizeButton = Instance.new("TextButton")
    MinimizeButton.Size = UDim2.new(0, 30, 0, 30)
    MinimizeButton.Position = UDim2.new(1, -70, 0, 5)  -- å…³é—­æŒ‰é’®å·¦ä¾§
    MinimizeButton.BackgroundColor3 = Color3.fromRGB(60, 60, 180)
    MinimizeButton.Text = "-"
    MinimizeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    MinimizeButton.Font = Enum.Font.GothamBold
    MinimizeButton.TextSize = 20
    MinimizeButton.Parent = TitleBar
    local MinCorner = Instance.new("UICorner")
    MinCorner.CornerRadius = UDim.new(0, 15)
    MinCorner.Parent = MinimizeButton
    -- å…³é—­æŒ‰é’® (è°ƒæ•´ä½ç½®)
    local CloseButton = Instance.new("TextButton")
    CloseButton.Size = UDim2.new(0, 30, 0, 30)
    CloseButton.Position = UDim2.new(1, -35, 0, 5)
    CloseButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
    CloseButton.Text = "Ã—"
    CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    CloseButton.Font = Enum.Font.GothamBold
    CloseButton.TextSize = 20
    CloseButton.Parent = TitleBar
    local CloseCorner = Instance.new("UICorner")
    CloseCorner.CornerRadius = UDim.new(0, 15)
    CloseCorner.Parent = CloseButton
    -- æœç´¢æ¡†
    local SearchContainer = Instance.new("Frame")
    SearchContainer.Size = UDim2.new(1, -30, 0, 40)
    SearchContainer.Position = UDim2.new(0, 15, 0, 50)
    SearchContainer.BackgroundColor3 = Color3.fromRGB(40, 40, 45)
    SearchContainer.BorderSizePixel = 0
    SearchContainer.Parent = MainFrame
    local SearchCorner = Instance.new("UICorner")
    SearchCorner.CornerRadius = UDim.new(0, 6)
    SearchCorner.Parent = SearchContainer
    local SearchBox = Instance.new("TextBox")
    SearchBox.Size = UDim2.new(1, -50, 1, 0)
    SearchBox.Position = UDim2.new(0, 10, 0, 0)
    SearchBox.BackgroundTransparency = 1
    SearchBox.Text = "æœç´¢ç©å®¶..."
    SearchBox.PlaceholderText = "è¾“å…¥ç©å®¶åç§°æœç´¢"
    SearchBox.TextColor3 = Color3.fromRGB(200, 200, 200)
    SearchBox.Font = Enum.Font.Gotham
    SearchBox.TextSize = 14
    SearchBox.TextXAlignment = Enum.TextXAlignment.Left
    SearchBox.ClearTextOnFocus = false
    SearchBox.Parent = SearchContainer
    local SearchIcon = Instance.new("ImageLabel")
    SearchIcon.Size = UDim2.new(0, 20, 0, 20)
    SearchIcon.Position = UDim2.new(1, -30, 0.5, -10)
    SearchIcon.BackgroundTransparency = 1
    SearchIcon.Image = "rbxassetid://3926305904"
    SearchIcon.ImageRectOffset = Vector2.new(964, 324)
    SearchIcon.ImageRectSize = Vector2.new(36, 36)
    SearchIcon.ImageColor3 = Color3.fromRGB(150, 150, 150)
    SearchIcon.Parent = SearchContainer
    -- ç©å®¶åˆ—è¡¨å®¹å™¨
    local ListContainer = Instance.new("ScrollingFrame")
    ListContainer.Size = UDim2.new(1, -30, 0, 200)
    ListContainer.Position = UDim2.new(0, 15, 0, 100)
    ListContainer.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
    ListContainer.BorderSizePixel = 0
    ListContainer.ScrollBarThickness = 4
    ListContainer.ScrollBarImageColor3 = Color3.fromRGB(100, 100, 100)
    ListContainer.CanvasSize = UDim2.new(0, 0, 0, 0)
    ListContainer.AutomaticCanvasSize = Enum.AutomaticSize.Y
    ListContainer.Parent = MainFrame
    local ListLayout = Instance.new("UIListLayout")
    ListLayout.Padding = UDim.new(0, 5)
    ListLayout.Parent = ListContainer
    -- æ§åˆ¶é¢æ¿
    local ControlPanel = Instance.new("Frame")
    ControlPanel.Size = UDim2.new(1, -30, 0, 100)
    ControlPanel.Position = UDim2.new(0, 15, 1, -120)
    ControlPanel.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
    ControlPanel.BorderSizePixel = 0
    ControlPanel.Parent = MainFrame
    local ControlCorner = Instance.new("UICorner")
    ControlCorner.CornerRadius = UDim.new(0, 8)
    ControlCorner.Parent = ControlPanel
    -- çŠ¶æ€æ˜¾ç¤º
    local StatusLabel = Instance.new("TextLabel")
    StatusLabel.Size = UDim2.new(1, -20, 0, 25)
    StatusLabel.Position = UDim2.new(0, 10, 0, 10)
    StatusLabel.BackgroundTransparency = 1
    StatusLabel.Text = "çŠ¶æ€: å¾…æœº"
    StatusLabel.TextColor3 = Color3.fromRGB(200, 200, 100)
    StatusLabel.Font = Enum.Font.Gotham
    StatusLabel.TextSize = 14
    StatusLabel.TextXAlignment = Enum.TextXAlignment.Left
    StatusLabel.Name = "StatusLabel"
    StatusLabel.Parent = ControlPanel
    local TargetLabel = Instance.new("TextLabel")
    TargetLabel.Size = UDim2.new(1, -20, 0, 20)
    TargetLabel.Position = UDim2.new(0, 10, 0, 35)
    TargetLabel.BackgroundTransparency = 1
    TargetLabel.Text = "ç›®æ ‡: æ— "
    TargetLabel.TextColor3 = Color3.fromRGB(170, 170, 255)
    TargetLabel.Font = Enum.Font.Gotham
    TargetLabel.TextSize = 13
    TargetLabel.TextXAlignment = Enum.TextXAlignment.Left
    TargetLabel.Name = "TargetLabel"
    TargetLabel.Parent = ControlPanel
    local DistanceLabel = Instance.new("TextLabel")
    DistanceLabel.Size = UDim2.new(1, -20, 0, 20)
    DistanceLabel.Position = UDim2.new(0, 10, 0, 55)
    DistanceLabel.BackgroundTransparency = 1
    DistanceLabel.Text = "è·ç¦»: -"
    DistanceLabel.TextColor3 = Color3.fromRGB(150, 255, 150)
    DistanceLabel.Font = Enum.Font.Gotham
    DistanceLabel.TextSize = 13
    DistanceLabel.TextXAlignment = Enum.TextXAlignment.Left
    DistanceLabel.Name = "DistanceLabel"
    DistanceLabel.Parent = ControlPanel
    -- æ§åˆ¶æŒ‰é’®
    local StartButton = Instance.new("TextButton")
    StartButton.Size = UDim2.new(0.48, 0, 0, 35)
    StartButton.Position = UDim2.new(0, 10, 1, -45)
    StartButton.BackgroundColor3 = Color3.fromRGB(60, 180, 60)
    StartButton.Text = "â–¶ å¼€å§‹ä¼ é€"
    StartButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    StartButton.Font = Enum.Font.GothamBold
    StartButton.TextSize = 14
    StartButton.Parent = ControlPanel
    local StopButton = Instance.new("TextButton")
    StopButton.Size = UDim2.new(0.48, 0, 0, 35)
    StopButton.Position = UDim2.new(0.52, 10, 1, -45)
    StopButton.BackgroundColor3 = Color3.fromRGB(180, 60, 60)
    StopButton.Text = "â–  åœæ­¢ä¼ é€"
    StopButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    StopButton.Font = Enum.Font.GothamBold
    StopButton.TextSize = 14
    StopButton.Parent = ControlPanel
    -- æŒ‰é’®åœ†è§’
    local ButtonCorner1 = Instance.new("UICorner")
    ButtonCorner1.CornerRadius = UDim.new(0, 6)
    ButtonCorner1.Parent = StartButton
    local ButtonCorner2 = Instance.new("UICorner")
    ButtonCorner2.CornerRadius = UDim.new(0, 6)
    ButtonCorner2.Parent = StopButton
    -- -------------- ä¼˜åŒ–ï¼šç§»åŠ¨é¡µé¢åŠŸèƒ½ --------------
    local Dragging = false
    local DragStart = nil
    local StartPosition = nil
    -- æ ‡é¢˜æ æ‹–åŠ¨æ£€æµ‹ï¼ˆä»…æ ‡é¢˜æ å¯æ‹–åŠ¨ï¼Œé¿å…è¯¯è§¦ï¼‰
    TitleBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            Dragging = true
            DragStart = input.Position
            StartPosition = MainFrame.Position
            -- é”å®šé¼ æ ‡ç›´åˆ°æ¾å¼€
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    Dragging = false
                end
            end)
        end
    end)
    -- æ‹–åŠ¨é€»è¾‘ä¼˜åŒ–ï¼ˆå‡å°‘å¡é¡¿ï¼‰
    UserInputService.InputChanged:Connect(function(input)
        if Dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - DragStart
            -- ç›´æ¥è®¾ç½®ä½ç½®ï¼Œé¿å…å†—ä½™è®¡ç®—
            MainFrame.Position = UDim2.new(
                StartPosition.X.Scale,
                StartPosition.X.Offset + delta.X,
                StartPosition.Y.Scale,
                StartPosition.Y.Offset + delta.Y
            )
        end
    end)
    -- -------------- æ–°å¢ï¼šæœ€å°åŒ–/è¿˜åŸåŠŸèƒ½ --------------
    local function ToggleMinimize()
        IsMinimized = not IsMinimized
        if IsMinimized then
            -- æœ€å°åŒ–ï¼šåªä¿ç•™æ ‡é¢˜æ 
            MainFrame.Size = UDim2.new(0, 350, 0, 40)
            -- éšè—æ‰€æœ‰å†…å®¹ï¼ˆé™¤æ ‡é¢˜æ ï¼‰
            SearchContainer.Visible = false
            ListContainer.Visible = false
            ControlPanel.Visible = false
            MinimizeButton.Text = "+"  -- æŒ‰é’®æ–‡æœ¬åˆ‡æ¢ä¸ºè¿˜åŸ
        else
            -- è¿˜åŸï¼šæ¢å¤åŸå°ºå¯¸å’Œæ‰€æœ‰å†…å®¹
            MainFrame.Size = UDim2.new(0, 350, 0, 400)
            SearchContainer.Visible = true
            ListContainer.Visible = true
            ControlPanel.Visible = true
            MinimizeButton.Text = "-"  -- æŒ‰é’®æ–‡æœ¬åˆ‡æ¢ä¸ºæœ€å°åŒ–
        end
    end
    -- æœ€å°åŒ–æŒ‰é’®ç‚¹å‡»äº‹ä»¶
    MinimizeButton.MouseButton1Click:Connect(ToggleMinimize)
    -- -------------- åŸæœ‰æŒ‰é’®äº‹ä»¶ --------------
    CloseButton.MouseButton1Click:Connect(function()
        ScreenGui:Destroy()
        UI = nil
    end)
    StartButton.MouseButton1Click:Connect(function()
        if TargetPlayer then
            StartTeleport()
        else
            ShowNotification("é”™è¯¯", "è¯·å…ˆé€‰æ‹©ç›®æ ‡ç©å®¶", 2)
        end
    end)
    StopButton.MouseButton1Click:Connect(function()
        StopTeleport()
    end)
    -- æœç´¢åŠŸèƒ½
    local function FilterPlayers(searchText)
        local players = GetOnlinePlayers()
        local filtered = {}
        if searchText == "" or searchText == "æœç´¢ç©å®¶..." then
            return players
        end
        for _, player in ipairs(players) do
            if string.find(string.lower(player.Name), string.lower(searchText)) then
                table.insert(filtered, player)
            end
        end
        return filtered
    end
    SearchBox.FocusLost:Connect(function(enterPressed)
        UpdatePlayerList()
    end)
    SearchBox:GetPropertyChangedSignal("Text"):Connect(function()
        UpdatePlayerList()
    end)
    -- æ›´æ–°ç©å®¶åˆ—è¡¨å‡½æ•°
    local function UpdatePlayerList()
        for _, child in ipairs(ListContainer:GetChildren()) do
            if child:IsA("Frame") then
                child:Destroy()
            end
        end
        local searchText = SearchBox.Text
        PlayersList = FilterPlayers(searchText)
        for _, player in ipairs(PlayersList) do
            local PlayerItem = Instance.new("Frame")
            PlayerItem.Size = UDim2.new(1, 0, 0, 50)
            PlayerItem.BackgroundColor3 = Color3.fromRGB(40, 40, 45)
            PlayerItem.BorderSizePixel = 0
            PlayerItem.Name = player.Name
            PlayerItem.Parent = ListContainer
            local ItemCorner = Instance.new("UICorner")
            ItemCorner.CornerRadius = UDim.new(0, 6)
            ItemCorner.Parent = PlayerItem
            local PlayerName = Instance.new("TextLabel")
            PlayerName.Size = UDim2.new(1, -60, 0, 25)
            PlayerName.Position = UDim2.new(0, 10, 0, 5)
            PlayerName.BackgroundTransparency = 1
            PlayerName.Text = player.Name
            PlayerName.TextColor3 = Color3.fromRGB(255, 255, 255)
            PlayerName.Font = Enum.Font.GothamBold
            PlayerName.TextSize = 16
            PlayerName.TextXAlignment = Enum.TextXAlignment.Left
            PlayerName.Parent = PlayerItem
            local PlayerDisplay = Instance.new("TextLabel")
            PlayerDisplay.Size = UDim2.new(1, -60, 0, 20)
            PlayerDisplay.Position = UDim2.new(0, 10, 0, 25)
            PlayerDisplay.BackgroundTransparency = 1
            PlayerDisplay.Text = "@" .. player.DisplayName
            PlayerDisplay.TextColor3 = Color3.fromRGB(180, 180, 180)
            PlayerDisplay.Font = Enum.Font.Gotham
            PlayerDisplay.TextSize = 12
            PlayerDisplay.TextXAlignment = Enum.TextXAlignment.Left
            PlayerDisplay.Parent = PlayerItem
            local SelectButton = Instance.new("TextButton")
            SelectButton.Size = UDim2.new(0, 40, 0, 40)
            SelectButton.Position = UDim2.new(1, -50, 0.5, -20)
            SelectButton.BackgroundColor3 = Color3.fromRGB(70, 70, 180)
            SelectButton.Text = "é€‰æ‹©"
            SelectButton.TextColor3 = Color3.fromRGB(255, 255, 255)
            SelectButton.Font = Enum.Font.Gotham
            SelectButton.TextSize = 12
            SelectButton.Parent = PlayerItem
            local SelectCorner = Instance.new("UICorner")
            SelectCorner.CornerRadius = UDim.new(0, 6)
            SelectCorner.Parent = SelectButton
            -- é€‰ä¸­çŠ¶æ€æŒ‡ç¤ºå™¨
            local SelectedIndicator = Instance.new("Frame")
            SelectedIndicator.Size = UDim2.new(1, 0, 0, 3)
            SelectedIndicator.Position = UDim2.new(0, 0, 1, -3)
            SelectedIndicator.BackgroundColor3 = Color3.fromRGB(100, 200, 255)
            SelectedIndicator.BorderSizePixel = 0
            SelectedIndicator.Visible = (player == TargetPlayer)
            SelectedIndicator.Name = "SelectedIndicator"
            SelectedIndicator.Parent = PlayerItem
            -- é€‰æ‹©æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            SelectButton.MouseButton1Click:Connect(function()
                TargetPlayer = player
                UpdatePlayerList()
                UpdateUIStatus()
                ShowNotification("ç›®æ ‡å·²é€‰æ‹©", "å½“å‰ç›®æ ‡: " .. player.Name, 2)
            end)
        end
    end
    -- æ›´æ–°UIçŠ¶æ€å‡½æ•°
    local function UpdateUIStatus()
        if StatusLabel then
            StatusLabel.Text = "çŠ¶æ€: " .. (Teleporting and "ä¼ é€ä¸­" or "å¾…æœº")
            StatusLabel.TextColor3 = Teleporting and Color3.fromRGB(100, 255, 100) or Color3.fromRGB(200, 200, 100)
        end
        if TargetLabel then
            TargetLabel.Text = "ç›®æ ‡: " .. (TargetPlayer and TargetPlayer.Name or "æ— ")
        end
        if DistanceLabel and TargetPlayer and Config.ShowDistance then
            local distance = GetDistance(LocalPlayer, TargetPlayer)
            DistanceLabel.Text = "è·ç¦»: " .. string.format("%.1f", distance) .. " ç±³"
        end
        -- æ›´æ–°åˆ—è¡¨é€‰ä¸­çŠ¶æ€
        for _, child in ipairs(ListContainer:GetChildren()) do
            if child:IsA("Frame") then
                local indicator = child:FindFirstChild("SelectedIndicator")
                if indicator then
                    indicator.Visible = (child.Name == (TargetPlayer and TargetPlayer.Name or ""))
                end
            end
        end
    end
    -- åˆå§‹åŒ–
    UpdatePlayerList()
    UpdateUIStatus()
    -- å®šæ—¶æ›´æ–°è·ç¦»
    local distanceUpdate = RunService.Heartbeat:Connect(function()
        if TargetPlayer and Config.ShowDistance and DistanceLabel then
            local distance = GetDistance(LocalPlayer, TargetPlayer)
            DistanceLabel.Text = "è·ç¦»: " .. string.format("%.1f", distance) .. " ç±³"
        end
    end)
    -- ç©å®¶åŠ å…¥/ç¦»å¼€äº‹ä»¶
    local function OnPlayerAdded(player)
        task.wait(1)
        UpdatePlayerList()
    end
    local function OnPlayerRemoving(player)
        if player == TargetPlayer then
            TargetPlayer = nil
            if Teleporting then
                StopTeleport()
                ShowNotification("ç›®æ ‡ä¸¢å¤±", "ç›®æ ‡ç©å®¶å·²ç¦»å¼€", 2)
            end
        end
        UpdatePlayerList()
    end
    Players.PlayerAdded:Connect(OnPlayerAdded)
    Players.PlayerRemoving:Connect(OnPlayerRemoving)
    -- è¿”å›UIå’Œæ›´æ–°å‡½æ•°
    return ScreenGui, UpdateUIStatus, UpdatePlayerList
end
-- å¼€å§‹ä¼ é€
function StartTeleport()
    if not TargetPlayer then
        ShowNotification("é”™è¯¯", "è¯·å…ˆé€‰æ‹©ç›®æ ‡ç©å®¶", 2)
        return
    end
    if not TargetPlayer.Character then
        ShowNotification("é”™è¯¯", "ç›®æ ‡ç©å®¶æ²¡æœ‰è§’è‰²", 2)
        return
    end
    if Teleporting then
        ShowNotification("æç¤º", "å·²ç»åœ¨ä¼ é€ä¸­", 2)
        return
    end
    Teleporting = true
    ShowNotification("ä¼ é€å¼€å§‹", "ç›®æ ‡: " .. TargetPlayer.Name, 2)
    -- å¯åŠ¨ä¼ é€å¾ªç¯
    MainLoop = RunService.Heartbeat:Connect(function()
        if not Teleporting or not TargetPlayer or not TargetPlayer.Character then
            if Teleporting then
                StopTeleport()
            end
            return
        end
        local targetChar = TargetPlayer.Character
        local targetHRP = targetChar:FindFirstChild("HumanoidRootPart")
        if not targetHRP then
            return
        end
        local targetPosition = targetHRP.Position + Vector3.new(0, Config.TeleportHeight, 0)
        local lookVector = (targetPosition - (HumanoidRootPart and HumanoidRootPart.Position or Vector3.new(0,0,0))).Unit
        local targetCFrame = CFrame.new(targetPosition, targetPosition + lookVector)
        if HumanoidRootPart then
            HumanoidRootPart.CFrame = targetCFrame
        end
    end)
    if UI then
        UpdateUIStatus()
    end
end
-- åœæ­¢ä¼ é€
function StopTeleport()
    if not Teleporting then
        return
    end
    Teleporting = false
    if MainLoop then
        MainLoop:Disconnect()
        MainLoop = nil
    end
    ShowNotification("ä¼ é€åœæ­¢", "å·²åœæ­¢ä¼ é€", 2)
    if UI then
        UpdateUIStatus()
    end
end
-- åˆå§‹åŒ–
task.wait(1)
-- åˆ›å»ºUI
UI, UpdateUIStatus, UpdatePlayerList = CreateDropdownUI()
-- æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯ï¼ˆæ–°å¢æœ€å°åŒ–åŠŸèƒ½è¯´æ˜ï¼‰
ShowNotification("å¿«é€Ÿä¼ é€è„šæœ¬å·²åŠ è½½", 
    "åŠŸèƒ½è¯´æ˜:\n" ..
    "1. ä»ä¸‹æ‹‰åˆ—è¡¨é€‰æ‹©ç©å®¶\n" ..
    "2. ç‚¹å‡»å¼€å§‹ä¼ é€æŒ‰é’®\n" ..
    "3. ç‚¹å‡»åœæ­¢ä¼ é€æŒ‰é’®\n" ..
    "4. æ ‡é¢˜æ å¯æ‹–åŠ¨çª—å£\n" ..
    "5. '-' æœ€å°åŒ– / '+' è¿˜åŸçª—å£\n" ..
    "ä¼ é€é€Ÿåº¦: " .. Config.TeleportSpeed, 
    6
)
-- è§’è‰²é‡ç”Ÿå¤„ç†
LocalPlayer.CharacterAdded:Connect(function(newChar)
    Character = newChar
    task.wait(0.5)
    HumanoidRootPart = newChar:WaitForChild("HumanoidRootPart")
    if Teleporting and Config.AutoRespawn then
        ShowNotification("è‡ªåŠ¨æ¢å¤", "è§’è‰²é‡ç”Ÿåç»§ç»­ä¼ é€", 2)
        task.wait(1)
        if TargetPlayer then
            Teleporting = true
        end
    end
end)
-- ä¸»å¾ªç¯
while task.wait(1) do
    if Teleporting and (not TargetPlayer or not TargetPlayer.Character) then
        StopTeleport()
    end
    -- æ¯5ç§’åˆ·æ–°ä¸€æ¬¡ç©å®¶åˆ—è¡¨
    if tick() % 5 < 1 then
        UpdatePlayerList()
    end
end